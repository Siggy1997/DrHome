<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.drhome.telehealth.TelehealthDAO">

	<select id="departmentKeyword" resultType="Map">
		SELECT dpno, dpkind, dpsymptom, dpkeyword, dpexample
		FROM department
	</select>
	
	<select id="doctorList" resultType="Map">
		SELECT h.*
		FROM hospitalList_view h
		WHERE h.dtelehealth = 1
	</select>
	
	<select id="kindDoctorList" parameterType="Map" resultType="Map">
		SELECT h.*
		FROM hospitalList_view h
		WHERE #{kindKeyword} = h.dpkind
		AND h.dtelehealth = 1
	</select>
	
	<select id="symptomDoctorList" parameterType="Map" resultType="Map">
		SELECT h.*
		FROM hospitalList_view h
		WHERE FIND_IN_SET(#{symptomKeyword}, h.dpkeyword)
		AND h.dtelehealth = 1
	</select>
	
	<select id="doctorNamelList" parameterType="Object" resultType="Map">
		SELECT h.*
		FROM hospitalList_view h
		WHERE h.dname LIKE CONCAT('%', #{keyword}, '%')
		AND h.dtelehealth = 1
	</select>
	
	<select id="doctor" parameterType="Integer" resultType="Map">
		SELECT h.*, COALESCE(COUNT(t.dno), 0) as count
		FROM hospitalList_view h 
		LEFT JOIN telehealth t ON h.dno = t.dno
		WHERE h.dno = #{dno}
	</select>
	
	<select id="doctorReview" parameterType="Integer" resultType="Map">
		SELECT r.mno, DATE_FORMAT(r.rdate, '%Y-%m-%d') AS rdate, r.rrate, r.rcontent, r.rkeyword, r.rlike, r.dno, r.hno, m.mname
		FROM review r
		JOIN member m ON m.mno = r.mno
		WHERE r.dno = #{dno}
	</select>
	
</mapper>